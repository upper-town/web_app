<div class="mb-2 sticky top-2">
  <%=
    form_with(
      method: :get,
      data: {
        controller: 'servers',
        action: 'change->servers#filter'
      }
    ) do |form| %>
      <%=
        form.select(
          :app,
          (
            options_for_select([@default_app_option], @selected_value_for_app) +
            grouped_options_for_select(@app_options, @selected_value_for_app)
          ),
          {},
          { class: 'block w-full' }
        )
      %>
      <div class="flex">
        <%=
          form.select(
            :period,
            @period_options,
            { selected: @selected_value_for_period },
            { class: 'block grow-0 md:w-1/3' }
          )
        %>
        <%=
          form.select(
            :country,
            (
              options_for_select([@default_country_code_option], @selected_value_for_country) +
              grouped_options_for_select(@country_code_options, @selected_value_for_country)
            ),
            {},
            { class: 'block grow md:w-2/3' }
          )
        %>
      </div>
  <% end %>

  <% if @servers.any? && @pagy.pages > 1 %>
    <%= render(PagyComponent.new(pagy: @pagy, pagy_link_proc: pagy_link_proc(@pagy), hidden_gap: true)) %>
  <% end %>
</div>

<% if @servers.any? %>
  <ul>
    <% @servers.each do |server| %>
      <li>
        <%=
          render(Servers::IndexResultComponent.new(
            server: server,
            period: @period,
            country_code: @country_code,
            server_stats_hash: @server_stats_hash[server.id]
          ))
        %>
      </li>
    <% end %>
  <ul>
<% else %>
  Not Found
<% end %>
